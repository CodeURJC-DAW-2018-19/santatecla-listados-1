{{>header}}
<script src="/ECharts/echarts.min.js"></script>
<!-- Modal Diagram-->
{{#admin}}
    <div class="modal" id="chartModal" tabindex="-1" role="dialog" aria-labelledby="chartModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" chartModal>Diagramas</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"></span>
                    </button>
                </div>
                <div class="modal-body" id="chartModalBody">
                    <div id="main" style="width: 500px;height:400px;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Add Lessons-->

    <div class="modal" id="AddLessonModal" tabindex="-1" role="dialog" aria-labelledby="AddLessonModal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="AddLessonModalHead">Crear Tema</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true"></span>
                    </button>
                </div>
                <div class="modal-body">
                    <form action="/saveLesson" method="post">
                        <div class="form-group">
                            {{#lesson}}<input type="hidden" name="id" value="{{id}}" class="form-control"/>{{/lesson}}
                            <label for="title">Nombre del tema</label>
                            <input type="text" id="title" name="title"
                                   {{#lesson}}value="{{title}}"{{/lesson}} class="form-control"/>
                        </div>
                        <button type="submit" class="btn btn-primary">Guardar tema</button>
                        <input type="hidden" name="_csrf" value="{{token}}"/>
                    </form>
                </div>
            </div>
        </div>
    </div>
{{/admin}}

<div id="contenedor" class="col-md-12">
    <div class="container-fluid">
        <!-- Row con la barra de busqueda -->
        <div class="row">
            <div class="col-md-10">
                <form class="form col-md-12" action="/lessonSearch" method="post" id="searchForm">
                    <div class="input-group no-border col-md-12">
                        <input type="text" value="" class="form-control" id="searchInput" name="searchText"
                               placeholder="Buscar...">
                        <button type="submit" id="searchButton" class="btn btn-white btn-round btn-just-icon">
                            <i class="material-icons">search</i>
                            <input type="hidden" name="_csrf" value="{{token}}"/>
                            <div class="ripple-container"></div>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="row" id="showMore">
            {{#lessons}}
                <div id="accordion" role="tablist" class="col-md-10">
                    <div class="card card-collapse" data-parent="#accordion">
                        <div class="card-header" role="tab" id="headingOne">
                            <h4 class="mb-0">
                                <a data-toggle="collapse" href="#{{title}}-{{id}}" aria-expanded="true"
                                   aria-controls="{{title}}-{{id}}"/>
                                {{title}}
                                <i class="material-icons" style="float: left">keyboard_arrow_down</i>
                                {{#admin}}
                                    <a class="material-icons" href="/deleteLessons/{{id}}"
                                       style="float: right">delete</a>
                                {{/admin}}
                                {{#student}}
                                    <a style="float: right">{{getAnswerCorrectOfConcepts}}
                                        :{{getAnswerIncorrectOfConcepts}}:{{getAnswerPendingOfConcepts}}
                                        /{{getSizeOfAnswerPendingOfConcepts}}</a>
                                {{/student}}
                                </a>
                            </h4>
                        </div>

                        <div id="{{title}}-{{id}}" class="collapse" role="tabpanel"
                             aria-labelledby="{{title}}-{{id}}"
                             data-parent="#accordion"
                             name="{{getAnswerCorrectOfConcepts}}:{{getAnswerIncorrectOfConcepts}}:{{getAnswerPendingOfConcepts}}">
                            <div class="card-body">
                                <ul class="list-group col-md-12">
                                    {{#conceptSet}}
                                        <div class="row">
                                            <li class="list-group-item col-md-8">
                                                {{#admin}}
                                                    <a href="/TeacherConcept_View/{{idConcept}}"> {{title}}</a>
                                                {{/admin}}
                                                {{#student}}
                                                    <a href="/StudentConceptView/{{idConcept}}"> {{title}}</a>
                                                {{/student}}
                                                {{#visitor}}
                                                    <p>{{title}}</p>
                                                {{/visitor}}
                                            </li>
                                            {{#admin}}
                                                <a class="material-icons" href="/deleteConcept/{{idConcept}}"
                                                   style="cursor: pointer">delete</a>
                                            {{/admin}}
                                            {{#student}}
                                                {{#setQuestion}}
                                                    <a style="cursor: pointer">{{getAnswerCorrect}}
                                                        :{{getAnswerIncorrect}}:{{getAnswerPending}}
                                                        /{{getSizeQuestions}}</a>
                                                {{/setQuestion}}
                                            {{/student}}
                                        </div>
                                    {{/conceptSet}}
                                    {{#admin}}
                                        <a class="material-icons" style="cursor: pointer"
                                           data-toggle="modal"
                                           href="#AddConceptModal{{id}}" id="buttonNewConcept"
                                           data-target="#AddConceptModal{{id}}">add_circle_outline</a>
                                        <!-- Modal Add Concept-->
                                        <div class="modal" id="AddConceptModal{{id}}" tabindex="-1" role="dialog"
                                             aria-labelledby="AddConceptModal{{id}}">
                                            <div class="modal-dialog" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                        <h5 class="modal-title" id="exampleModalLongTitle">Crear
                                                            concepto</h5>
                                                        <button type="button" class="close" data-dismiss="modal"
                                                                aria-label="Close">
                                                            <span aria-hidden="true"></span>
                                                        </button>
                                                    </div>
                                                    <div class="modal-body">
                                                        <form action="/saveConcept/{{id}}" method="post"
                                                              enctype="multipart/form-data">
                                                            <div class="form-group">
                                                                {{#concept}}<input type="hidden" name="idConcept"
                                                                                   value="{{idConcept}}"
                                                                                   class="form-control"/>{{/concept}}
                                                                {{#concept}}
                                                                    <input type="hidden" name="idLesson" value="{{id}}"
                                                                           class="form-control"/>{{/concept}}
                                                                <label for="title">Nombre del concepto</label>
                                                                <input type="text" id="title" name="title"
                                                                       {{#concept}}value="{{title}}"{{/concept}}
                                                                       class="form-control"/>
                                                            </div>
                                                            <div class="fileinput fileinput-new text-center"
                                                                 data-provides="fileinput">
                                                                <div>
                                                                    <span class="btn btn-raised btn-default btn-file">
                                                                        <input type="file" name="file"/>
                                                                    </span>
                                                                    <a class="btn btn-danger btn-round fileinput-exists"
                                                                       data-dismiss="fileinput"><i
                                                                            class="fa fa-times"></i> Remove</a>
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary"
                                                                        data-dismiss="modal">Cerrar
                                                                </button>
                                                                <button type="submit" class="btn btn-primary">Guardar
                                                                    concepto
                                                                </button>
                                                                <input type="hidden" name="_csrf" value="{{token}}"/>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    {{/admin}}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            {{/lessons}}
        </div>


        <button type="button" id="loadMore" class="btn btn-default align-self-md-end">Mas temas</button>
        <script src="/js/loadMore.js"></script>
        <script>loadMoreLesson()</script>
        <div class="row">
            <div class="col-md-10">
                {{#admin}}
                    <a class="material-icons" style="cursor: pointer" data-toggle="modal" href="#AddLessonModal"
                       data-target="#AddLessonModal">add_circle_outline</a>
                {{/admin}}
            </div>
            {{^visitor}}
                <div class="col-md-2 border-dark badge-white align-content-md-end">
                    <button id="diagramas" type="button" class="btn btn-default align-self-md-end" data-toggle="modal"
                            data-target="#chartModal">Diagramas
                    </button>
                </div>
            {{/visitor}}
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $('#loadMore').click(function () {
            loadMoreLesson();
        });
        // based on prepared DOM, initialize echarts instance
        var myChart = echarts.init(document.getElementById('main'));
        var datos = [5, 6, 7];
        // specify chart configuration item and data
        var option = {
            title: {
                text: ' % RESPUESTAS'
            },
            tooltip: {},
            legend: {
                data: ['Sales']
            },
            xAxis: {
                data: ["Correctas", "Incorrectas", "Sin responder"]
            },
            yAxis: {},
            series: [{
                name: 'Sales',
                type: 'bar',
                data: [datos[0], datos[1], datos[2]]
            }]
        };

        $('#diagramas').click(function () {
            datos = $(".collapse.show").first().attr("name").split(':');
            if(datos){
                var option = {
                    title: {
                        text: ' % RESPUESTAS'
                    },
                    tooltip: {},
                    legend: {
                        data: ['Preguntas']
                    },
                    xAxis: {
                        data: ["Correctas", "Incorrectas", "Sin responder"]
                    },
                    yAxis: {},
                    series: [{
                        name: 'Preguntas',
                        type: 'bar',
                        data: [datos[0], datos[1], datos[2]]
                    }]
                };
                myChart.setOption(option);
            }else{
                var datos = [0, 0, 0];
            }

        });
        // use configuration item and data specified to show chart
        myChart.setOption(option);
    });


</script>

{{>footer}}